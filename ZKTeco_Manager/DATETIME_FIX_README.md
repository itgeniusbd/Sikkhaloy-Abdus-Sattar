# ZKTeco Device Date/Time Configuration Fix

## ?????? (Problem)

????? ZKTeco iClock9000-G ??????? Date/Time format ??? ????????:
- **??? Format:** `12:13:38 11:10 AM` (?????? ????? time format)
- **???? Format ????? ????:** `13-12-24 11:10:38` (DD-MM-YY HH:MM:SS)

## ?????? (Solution)

### ?????? ?: Device LCD Menu ???? (??????? ??? ? ???????) ?

1. ???????? **Menu** ???? ?????
2. **System** ? **Date/Time** ???
3. ????? settings ????:
   ```
   Date Format: DD-MM-YY (???? DD-MM-YYYY)
   Time Format: 24H (24 hour format)
   Time Zone: GMT+6 (Bangladesh)
   ```
4. **OK** ????? ??? **Save** ????
5. **Menu** ? **System** ? **Restart Device**

### ?????? ?: NTP Server ????? Auto Time Sync (Best Practice) ?

1. ???????? **Menu** ???? ?????
2. **Comm** ? **NTP Server** ???
3. ????? settings ????:
   ```
   Enable NTP: Yes
   NTP Server: time.google.com
   Time Zone: +6
   Auto Sync: Yes
   Sync Interval: 24 (hours)
   ```
4. **Test Connection** ????
5. Success ??? **Save** ????
6. Device restart ????

### ?????? ?: Web Interface ????

1. Browser ? device ?? IP address ??? (????: `http://192.168.1.100`)
2. Login ???? (default username: `admin`, password: `admin`)
3. **System** ? **Date/Time Settings** ???
4. Select ????:
   ```
   Date Format: DD-MM-YY
   Time Format: 24H
   Time Zone: +6:00 (Dhaka)
   ```
5. **Apply** ??? **Save Configuration** ????
6. Device restart ????

### ?????? ?: API ???? Configuration Check

????? Push API ???? device configuration check ???? ?????:

```bash
GET https://pushapi.sikkhaloy.com/iclock/configure-datetime?SN=YOUR_DEVICE_SN
```

??? ?????? ????????? configuration instructions ?????

## Verification (????? ????)

Device configure ???? ?? verify ????:

1. **Device Display Check:**
   - Device ?? screen ? time ?????
   - ???? format: `13-12-24 11:10:38`
   - ??? format: `12:13:38 11:10 AM`

2. **Test Punch:**
   - ???? fingerprint scan ????
   - Device display ?? ????? ?? ????????
   - Database ? check ???? ???????? save ?????? ????

3. **API Check:**
   ```bash
   GET https://pushapi.sikkhaloy.com/api/devices/test?sn=YOUR_DEVICE_SN
   ```

4. **Today's Logs:**
   ```bash
   GET https://pushapi.sikkhaloy.com/api/logs/view?date=2024-12-13
   ```

## API Code Updates

????? Push API code ? ???? features ??? ??? ??????:

### 1. Date/Time Configuration Endpoint
```
GET /iclock/configure-datetime?SN=DEVICE_SERIAL&format=DD-MM-YY&timezone=6
```

### 2. Device Command Queue System
- Device ?? command ??????? ???? queue system
- Commands automatically device ?? next request ? send ???

### 3. Enhanced Date Parser
`ParseDateTime` method ??? support ???:
- `DD-MM-YY HH:mm:ss` (Device default)
- `DD-MM-YYYY HH:mm:ss`
- `DD/MM/YY HH:mm:ss`
- `yyyy-MM-dd HH:mm:ss` (ISO format)

## Database Changes

???? ???? table ??? ??? ??????:

```sql
CREATE TABLE Device_Commands (
    CommandID INT IDENTITY(1,1) PRIMARY KEY,
    DeviceSerialNumber NVARCHAR(100) NOT NULL,
    Command NVARCHAR(MAX) NOT NULL,
    CommandType NVARCHAR(50) NULL,
    CommandStatus NVARCHAR(50) DEFAULT 'Pending',
    CreatedDate DATETIME DEFAULT GETDATE(),
    ProcessedDate DATETIME NULL,
    ResponseData NVARCHAR(MAX) NULL,
    ErrorMessage NVARCHAR(MAX) NULL
)
```

## Installation Steps

1. **Database Table ???? ????:**
   ```sql
   -- Run this SQL script
   -- File: Create_Device_Commands_Table.sql
   ```

2. **API Deploy ????:**
   - Push API project build ????
   - IIS ?? deploy ????
   - Test ????

3. **Device Configure ????:**
   - ????? ?????? ? ?? ? follow ????
   - Device restart ????

## Troubleshooting

### ??????: Device ? settings save ????? ??

**??????:**
- Device admin password ???? ???? factory reset ???? ???
- iClock9000-G factory reset: Device ????? Reset button 10 ??????? ???? ????

### ??????: NTP Server connect ????? ??

**??????:**
- Device internet connection check ????
- Alternative NTP servers try ????:
  - `pool.ntp.org`
  - `time.windows.com`
  - `time.nist.gov`

### ??????: Time ??? ??? ?????? format ???? ???

**??????:**
- Device firmware update ???? (if available)
- Manual configuration ???? (?????? ?)
- API code ???????? multiple formats support ???, ??? data save ???

## Important Notes

1. ?? **Device Restart Required:** ?? configuration change ???? ?? device restart ???? ???
2. ? **NTP Server Recommended:** Auto time sync ?? ???? NTP server ??????? ????
3. ?? **Date Format Priority:** DD-MM-YY format ??????? ???? compatibility ????
4. ?? **Regular Check:** ???? ????? device time check ????

## Testing Checklist

- [ ] Device ? Date Format: DD-MM-YY
- [ ] Device ? Time Format: 24H (no AM/PM)
- [ ] Device ? TimeZone: GMT+6
- [ ] NTP Server configured (if supported)
- [ ] Device display ?? ???? time ????????
- [ ] Test punch ??? verify ??? ??????
- [ ] Database ? ???? data save ?????
- [ ] API logs ? error ???

## Support

??? ???? ?????? ???:

1. Device logs check ????:
   ```
   https://pushapi.sikkhaloy.com/api/logs/view?date=TODAY
   ```

2. Device status check ????:
   ```
   https://pushapi.sikkhaloy.com/api/devices/test?sn=YOUR_SERIAL
   ```

3. Configuration guide ?????:
   ```
   File: DEVICE_CONFIGURATION_GUIDE.md
   ```

## Files Changed

1. `IclockController.cs` - ???? endpoints ??? ??? ??????
2. `AttendanceRepository.cs` - Command store methods ??? ??? ??????
3. `DEVICE_CONFIGURATION_GUIDE.md` - Updated with DateTime troubleshooting
4. `Create_Device_Commands_Table.sql` - New database table
5. `DATETIME_FIX_README.md` - This file

## Conclusion

?? fix ?? ???????:
- ? Device date/time format ??? ??? ????
- ? API multiple date formats support ????
- ? Future ? automatic configuration possible
- ? Better error handling ??? logging

**??? ??????:** ZKTeco devices ?? Date/Time configuration ??????? device hardware level ???? ???? ???? API ????????? data receive ???? ???? different formats handle ???? ?????

---

**???????! ??**
