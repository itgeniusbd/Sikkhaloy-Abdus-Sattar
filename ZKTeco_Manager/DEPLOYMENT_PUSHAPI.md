# ZKTeco.PushAPI Deployment Guide

## ?????
ZKTeco.PushAPI ?? ???? ASP.NET Web API ???????? ?? ZKTeco ?????? ???? ??? ???? ????? ???? ???? ??????? ????

## ?????????????
- IIS 7.5 ?? ??? ????
- .NET Framework 4.7.2
- Windows Server 2012 R2 ?? ??? ???? (???? Windows 10/11)

## ???????????? ???

### ?. ???????? ????? ????

#### Visual Studio ????:
1. ZKTeco_Manager ?????? ?????
2. Solution Explorer ???? `ZKTeco.PushAPI` ???????? ??????? ????
3. ????????? ???? ????? ??? **Build** ??????? ????
4. ???? ???? ?????? ????? ????: **Build > Build Solution** (Ctrl+Shift+B)

#### Command Line ????:
```powershell
# ZKTeco_Manager ???????? ???
cd ZKTeco_Manager

# ???? PushAPI ???????? ????? ????
msbuild ZKTeco.PushAPI\ZKTeco.PushAPI.csproj /p:Configuration=Release

# ???? ???? ?????? ????? ????
msbuild ZKTeco_Manager.sln /p:Configuration=Release
```

### ?. Publish ????

#### Visual Studio ????:
1. Solution Explorer ? `ZKTeco.PushAPI` ????????? ???? ????? ????
2. **Publish** ??????? ????
3. **Folder** ??????? ??????? ????
4. Publish Location ??? ????: `C:\inetpub\wwwroot\ZKTecoPushAPI`
5. **Publish** ????? ????? ????

#### Command Line ????:
```powershell
# Publish ????
msbuild ZKTeco.PushAPI\ZKTeco.PushAPI.csproj /p:DeployOnBuild=true /p:PublishProfile=FolderProfile /p:Configuration=Release /p:PublishUrl="C:\inetpub\wwwroot\ZKTecoPushAPI"
```

### ?. IIS ??????????

#### IIS Manager ?????:

1. **IIS Manager** ????? (inetmgr)
2. **Sites** ???? ???? ????? ??? **Add Website** ??????? ????
3. ????? ???? ???:
   - **Site name**: ZKTecoPushAPI
   - **Physical path**: `C:\inetpub\wwwroot\ZKTecoPushAPI`
   - **Port**: 8080 (???? ????? ??????? ?????)
   - **Host name**: (???? ????? ?? ????? ?????? ???)

4. **Application Pool** ??????? ????:
   - Application Pool ??????? ??? **Advanced Settings** ?????
   - **.NET CLR Version**: v4.0
   - **Managed Pipeline Mode**: Integrated

#### PowerShell ?????:
```powershell
# IIS ????? ?????? ???? (??? ???????? ?????? ?? ????)
Install-WindowsFeature -Name Web-Server -IncludeManagementTools

# Application Pool ???? ????
Import-Module WebAdministration
New-WebAppPool -Name "ZKTecoPushAPI"
Set-ItemProperty IIS:\AppPools\ZKTecoPushAPI -Name managedRuntimeVersion -Value "v4.0"

# Website ???? ????
New-Website -Name "ZKTecoPushAPI" `
            -Port 8080 `
            -PhysicalPath "C:\inetpub\wwwroot\ZKTecoPushAPI" `
            -ApplicationPool "ZKTecoPushAPI"

# Website Start ????
Start-Website -Name "ZKTecoPushAPI"
```

### ?. Firewall ??????? ????

```powershell
# ????? 8080 ???? ????
New-NetFirewallRule -DisplayName "ZKTeco Push API" `
                    -Direction Inbound `
                    -Protocol TCP `
                    -LocalPort 8080 `
                    -Action Allow
```

### ?. ??????? ????

???????? ????? ????? ????:
```
http://localhost:8080/api/iclock
```

???? PowerShell ?????:
```powershell
Invoke-WebRequest -Uri "http://localhost:8080/api/iclock" -Method GET
```

## ?????? ??????????

ZKTeco ??????? Push URL ??? ????:
```
http://[SERVER_IP]:8080/api/iclock
```

## ???????????

### ????? ??????? ????? ???? ??? ????:
```powershell
netstat -ano | findstr :8080
```

### IIS ?? ?????:
```powershell
Get-Content "C:\inetpub\logs\LogFiles\W3SVC1\*.log" -Tail 50
```

### Web.config ??? ????:
??????? ???? ?? `Web.config` ????? ???? ?????????? ????

## ????????? ???????

1. **HTTPS ??????? ????** ??????????
2. **IP Restriction** ??? ???? ????????? ?????? IP ???? ?????? ????
3. **Authentication** ??? ???? API endpoint ?
4. **Rate Limiting** ??????????? ???? DoS ?????????? ????

## ????? ???? ????

1. Website ???? ????:
```powershell
Stop-Website -Name "ZKTecoPushAPI"
```

2. ???? ???? ??? ????
3. Website ???? ????:
```powershell
Start-Website -Name "ZKTecoPushAPI"
```

## ???????? ???????????? ?????????

???? ???????? PowerShell ????????? ?????: `Deploy-PushAPI.ps1`
