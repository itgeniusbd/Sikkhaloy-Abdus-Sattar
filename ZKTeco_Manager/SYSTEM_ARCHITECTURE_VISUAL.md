# ?? ZKTeco System Architecture - Visual Guide

## ?? System Overview

```
???????????????????????????????????????????????????????????????????
?                     Sikkhaloy System                            ?
?                                                                 ?
?  ????????????????        ????????????????     ??????????????? ?
?  ?  SQL Server  ??????????   PushAPI    ???????  ZKTeco     ? ?
?  ?   Database   ?        ?  (IIS Web)   ?     ?  Device     ? ?
?  ????????????????        ????????????????     ??????????????? ?
?         ?                        ?                    ?        ?
?         ?                        ?                    ?        ?
?         ?                        ?                    ?        ?
?         ?                ?????????????????            ?        ?
?         ?                ?               ?            ?        ?
?         ?         ??????????????? ???????????????   ?        ?
?         ?         ?   Device    ? ?   Sync      ?   ?        ?
?         ??????????? Management  ? ?   Tool      ?????        ?
?                   ?     API     ? ? (Console)   ?            ?
?                   ??????????????? ???????????????            ?
?                                                                ?
???????????????????????????????????????????????????????????????????
```

---

## ?? Data Flow: Device ? Database (Attendance)

```
Step 1: Student finger scan ???
         ?
         ?
???????????????????
?  ZKTeco Device  ? DeviceID: 1 (?????? ????)
?  192.168.0.201  ? Time: 08:05 AM
??????????????????? Status: 0 (Check-in)
         ?
         ? HTTP POST (Push Protocol)
         ? /iclock/cdata?SN=BBKB193260050&table=ATTLOG
         ?
         ?
???????????????????
?    PushAPI      ? 1. Parse data
?  IclockController? 2. Get SchoolID from DeviceSerial
??????????????????? 3. Get User Info
         ?         4. Get Schedule
         ?         5. Calculate Status (Pre/Late/Late Abs)
         ?
???????????????????
? AttendanceService? Process Logic:
?                 ? - Time: 08:05 AM
??????????????????? - Start: 08:00 AM
         ?         - Late: 08:15 AM
         ?         ? Status = "Late"
         ?
???????????????????
?  SQL Server DB  ? INSERT INTO Attendance_Record
?                 ? (StudentID, Attendance, EntryTime, ...)
??????????????????? VALUES (1, 'Late', '08:05:00', ...)

Result: ? Attendance saved automatically!
```

---

## ?? Data Flow: Database ? Device (User Sync)

```
Step 1: Admin ???? device ? user sync ????
         ?
         ?
???????????????????
?   Sync Tool     ? Command: .\ZKTeco.DeviceSync.exe
?  (Console App)  ? Input: Device ID = 1
???????????????????
         ?
         ? HTTP GET
         ? /api/device/1/users
         ?
         ?
???????????????????
?    PushAPI      ? Query Database:
?  DeviceManagement? SELECT s.DeviceID, s.StudentsName
?   Controller    ? FROM Student s
??????????????????? WHERE SchoolID = 1
         ?         AND Status = 'Active'
         ?
???????????????????
?  SQL Server DB  ? Returns:
?                 ? - 120 Students
??????????????????? - 30 Employees
         ?         - Total: 150 Users
         ?
         ? JSON Response
         ? { "TotalUsers": 150, "Users": [...] }
         ?
         ?
???????????????????
?   Sync Tool     ? For each user:
?  ZKTeco SDK     ? zkDevice.SSR_SetUserInfo(...)
???????????????????
         ?
         ? TCP/IP Connection
         ? Port: 4370
         ?
         ?
???????????????????
?  ZKTeco Device  ? User Info Saved:
?  192.168.0.201  ? - DeviceID: 1
??????????????????? - Name: ?????? ????
                    - Status: Active

Result: ? 150 users synced to device!
```

---

## ?? Device Table Schema

```
?????????????????????????????????????????????????????
?                 Device Table                      ?
?????????????????????????????????????????????????????
? Column       ? Type            ? Purpose          ?
?????????????????????????????????????????????????????
? DeviceID     ? INT (PK)        ? Unique ID        ?
? DeviceSerial ? NVARCHAR(50)    ? Device S/N ?     ?
? DeviceName   ? NVARCHAR(100)   ? Friendly name    ?
? DeviceIP     ? NVARCHAR(15)    ? IP address       ?
? Port         ? INT             ? Port (4370)      ?
? SchoolID     ? INT (FK) ?      ? Which school     ?
? DeviceStatus ? NVARCHAR(20)    ? Active/Inactive  ?
? LastSyncTime ? DATETIME        ? Last sync time   ?
?????????????????????????????????????????????????????

? Key Relationship:
  DeviceSerial ? SchoolID ? School Data
```

---

## ?? Relationship Diagram

```
???????????????
? SchoolInfo  ?
? SchoolID=1  ?
? Name: ABC   ?
???????????????
       ?
       ? 1 School has many Devices
       ?
       ?
???????????????     ???????????????     ???????????????
?  Device #1  ?     ?  Device #2  ?     ?  Device #3  ?
? Main Gate   ?     ? Back Gate   ?     ? Office      ?
? IP: .201    ?     ? IP: .202    ?     ? IP: .203    ?
???????????????     ???????????????     ???????????????
       ?                   ?                   ?
       ?????????????????????????????????????????
                           ?
                           ? Device used by Students & Employees
                           ?
       ?????????????????????????????????????????
       ?                                       ?
       ?                                       ?
???????????????                         ???????????????
?  Student    ?                         ?  Employee   ?
? DeviceID=1  ?                         ? DeviceID=2  ?
? Name: ????  ?                         ? Name: ????  ?
???????????????                         ???????????????
```

---

## ?? Use Cases

### Use Case 1: ???? Student Enroll ???

```
1. Database ? Student add ????
   ?? INSERT INTO Student (..., DeviceID=1, ...)

2. Fingerprint capture ????
   ?? INSERT INTO User_FingerPrint (StudentID, Finger_Index, Temp_Data, ...)

3. Device ? sync ????
   ?? Sync Tool ????? ? Device ? user push ???

4. Student finger scan ???
   ?? Device ? PushAPI ? Database ? attendance save ???

? Complete!
```

### Use Case 2: ???? Device Setup ???

```
1. Device ????? ??? network ? connect ????

2. Device Serial Number ??? ????
   ?? Device Menu ? System Info ? Serial

3. Database ? device register ????
   ?? INSERT INTO Device (DeviceSerial='XXX', SchoolID=1, ...)

4. Device ? Push URL configure ????
   ?? Device Menu ? Communication ? Push URL
   ?? http://YOUR_SERVER:8080/iclock/cdata

5. ?? user sync ????
   ?? Sync Tool ?????

6. Test ????
   ?? Finger scan ??? database check ????

? Device ready!
```

---

## ?? Comparison: Old vs New

### Old System (AttendanceDevice):
```
[Sikkhaloy DB]
     ?
[Local App + SQLite]
     ?
[ZKTeco SDK]
     ?
[Device]
     ?
[Manual Sync Back]
     ?
[Sikkhaloy DB]
```

### New System (PushAPI):
```
[Sikkhaloy DB]
     ?
[PushAPI]
     ? ?
[ZKTeco Device] ????? Real-time Push
     ?
[Sync Tool] ????? On-demand User Sync
```

---

## ?? Status Flow Chart

```
Finger Scan at 08:05 AM
         ?
         ?? Before 08:00 ? Status = "Pre" (Present)
         ?
         ?? 08:00 - 08:15 ? Status = "Late"
         ?
         ?? 08:15 - 15:00 ? Status = "Late Abs"
         ?
         ?? After 15:00 ? Exit Time or Ignored
```

---

## ?? Mobile/Web Dashboard (Future)

```
???????????????????????????????????????
?       Admin Dashboard               ?
?                                     ?
?  ?? Today's Attendance              ?
?  ?? Present: 100                    ?
?  ?? Late: 15                        ?
?  ?? Absent: 5                       ?
?  ?? Late Abs: 10                    ?
?                                     ?
?  ?? Devices                         ?
?  ?? Main Gate [?Active]            ?
?  ?? Back Gate [?Active]            ?
?  ?? Office [?Offline]              ?
?                                     ?
?  ?? Sync Status                     ?
?  ?? Last Sync: 10:30 AM            ?
?  ?? Users: 150                      ?
?  ?? Fingerprints: 300               ?
?                                     ?
?  [Sync Now] [View Reports]         ?
???????????????????????????????????????
```

---

## ?? Summary

### ? Questions Answered:

**Q1: Device ??? School ?? ????? ???????**
- A: Device table ? DeviceSerial ? SchoolID mapping

**Q2: ????????? ???? ???? Device ? ?????? ???????**
- A: Device Management API + Sync Tool

### ? System Benefits:

1. **Centralized** - ?? data ?? ????????
2. **Real-time** - Instant attendance save
3. **Scalable** - Unlimited devices
4. **Remote** - ????? ?????? ???? manage
5. **Automated** - Minimal manual work

---

**?? ???? ??? clear! ??**

For detailed guide: `DEVICE_MANAGEMENT_GUIDE.md`
